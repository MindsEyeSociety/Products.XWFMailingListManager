<html metal:use-macro="context/@@groupserver_layout/page">
  <head>
    <title metal:fill-slot="title">All posts in
      <span tal:define="retval view/update;"
        tal:replace="view/topicName">
        Standard Template for a Single Post
      </span>:
      <span tal:replace="view/groupInfo/name"/>:
      <span tal:replace="view/siteInfo/name"/>
    </title>
    <tal:block metal:fill-slot="metadata" 
      tal:define="topicName view/topicName">
      <link tal:condition="view/previousTopic/topicId" 
        rel="prev" title="Previous topic" href="wibble"
        tal:attributes="href view/previousTopic/topicId; 
        title string:Later topic: ${view/previousTopic/subject}" />
      <link tal:condition="view/nextTopic/topicId" 
        rel="next" title="earlier topic" href="wibble"
        tal:attributes="href view/nextTopic/topicId; 
        title string:Earlier topic: ${view/nextTopic/subject};" />
      <link rel="up" title="All topics" href="../topics.html"
        tal:attributes="title string:Topics in ${view/groupInfo/name};"/>
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title string:${view/groupInfo/name} Homepage;
        href view/groupInfo/url" />
      <link rel="home" 
        tal:attributes="title string:${view/siteInfo/name} Homepage;
        href view/siteInfo/url" />
      <link rel="help" 
        tal:attributes="title string:${view/siteInfo/name} Help;
        href string:${view/siteInfo/url}/help" />
    </tal:block>
  </head>
  
  <body>
    <div metal:fill-slot="messages" tal:condition="view/status" 
      class="message-error"
      tal:define="e view/errors"
      tal:attributes="class python:e and 'message-error' or 'message-result'">
      <p class="form-status" tal:content="structure view/status"/>
      <dl tal:condition="view/errors">
        <tal:block repeat="widget view/widgets">
          <tal:block tal:condition="widget/error">
            <dt tal:content="widget/label">Widget Name</dt>
            <dd class="error" 
              tal:content="structure widget/error">Error message</dd>
          </tal:block>
        </tal:block>
      </dl>
    </div>
    <tal:block metal:fill-slot="body"
      define="topicList view/topic"
      condition="topicList">
      <h1>All posts in the topic
        <cite tal:content="view/topicName">This Topic</cite>
        <a href="#" title="A short link to this topic" 
          class="shortLink"
          tal:define="topicName view/topicName;
          lastPostId python:topicList[-1]['post_id']"
          tal:attributes="href string:/r/topic/${lastPostId};
          title string:A short link to all posts in ${topicName}">(Short 
          link)</a>
      </h1>
      
      <!--form method="post" enctype="multipart/form-data"
        class="adminTasks" id="toggleStickyTopic"
        tal:attributes="action request/URL"
        tal:define="topic view/get_topic_name;
        groupInfo view/groupInfo;
        siteInfo view/siteInfo;
        roles python:user.getRolesInContext(groupInfo.groupObj);
        isGroupAdmin python:'GroupAdmin' in roles;
        isDivisionAdmin python:'DivisionAdmin' in roles;
        topicId python:view.topicId;"
        tal:condition="python:isGroupAdmin or isDivisionAdmin">
        <p 
          tal:define="pageTemplateFileName string:browser/templates/toggleStickyTopicFormData.pt"
          tal:replace="structure provider:groupserver.StickyTopicToggle">
          The space for the hidden metadata associated with the
          sticky topic toggle.
        </p>
      <p tal:define="pageTemplateFileName string:browser/templates/toggleStickyTopicForm.pt;"
          tal:replace="structure provider:groupserver.StickyTopicToggle">
          The button to do the toggling!.
        </p>
      </form-->
      
      <div class="messages-nl" id="topicNavigation">
        <p class="label">Topic Navigation</p>
        <ul>
          <li class="prev">
            <span tal:condition="not:view/previousTopic/topicId">No later 
              topic</span>
          <a href="#" tal:condition="view/previousTopic/topicId"
              tal:attributes="href view/previousTopic/topicId;
                title string:The topic with more recent posts: view/previousTopic/subject;">
              Later topic: <cite tal:content="view/previousTopic/subject">Topic Name</cite>
            </a>
          </li>
          <li class="next">
            <span tal:condition="not:view/nextTopic/topicId">No 
              earlier topic</span>
            <a tal:condition="view/nextTopic/topicId" href="#"
              tal:attributes="href view/nextTopic/topicId;
              title string:The topic with earlier posts: ${view/nextTopic/subject};">Earlier
              topic: <cite tal:content="view/nextTopic/subject">Topic 
                Name</cite></a>
          </li>
        </ul>
      </div>
      <div class="messages-nl" id="usefulLinks">
      <p class="label">Useful Links</p>
      <ul>
        <li class="topics">
          <a href="../topics.html">Topics in 
            <span tal:replace="view/groupInfo/name"/></a> 
          </li>
        </ul>
      </div>

      <div tal:define="topic topicList" 
        tal:condition="python:len(topic) &gt; 1"
        tal:replace="structure provider:groupserver.TopicSummary"/>
      
      <p tal:define="topic topicList"
        tal:replace="structure provider:groupserver.TopicIndex"/>
      
      <div class="postList">
        <tal:block repeat="post topicList">
          <p tal:define="position repeat/post/number;
            showPhoto python:(position==1) or (topicList[position-1]['author_id'] != topicList[position-2]['author_id'])"
            tal:replace="structure provider:groupserver.Post">
            The email message is rendered by the Post content provider,
            not by this page.
          </p>
        </tal:block>
      </div><!--postList-->
      
      <form enctype="multipart/form-data"  method="post" action="."
        id="add-to-topic" tal:attributes="action request/URL">
        <h2>Add to the topic
          <cite class="topic" 
            tal:content="view/topicName">topicName</cite></h2>
        <tal:block define="widgets python:[view.widgets['fromAddress'], view.widgets['message']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>
        <div class="buttons" tal:condition="view/availableActions">
          <div class="formelementbutton">
            <span 
              tal:replace="structure python:view.availableActions()[0].render()">Button</span>
          </div>
        </div><!--buttons-->
      </form><!--posting-->
      
      <!--div id="posting">
        <h2>Add to the topic
          <cite class="topic" 
            tal:content="view/get_topic_name">topicName</cite>
          <a title="Help with posting a message" 
            href="/help/manual/#groupserver-posting-a-message-using-the-web"
            class="helpLink">[?]</a></h2>
        <form method="post" tal:attributes="action request/URL"
          enctype="multipart/form-data"
          tal:condition="view/userPostingInfo/canPost"
          tal:define="startNew python:False; 
          topic view/get_topic_name;
          replyToId python:topicList[-1]['post_id'];">
        
          <p style="display: none;" 
            tal:define="pageTemplateFileName string:browser/templates/postMessageData.pt"
            tal:replace="structure provider:groupserver.PostMessage">
            The space for the hidden metadata associated with the new post.
          </p>
          <p tal:replace="structure provider:groupserver.PostMessage">
            The space to allow people to write the new post.
          </p>
        </form--><!-- Posting Form -->
        <p class="message-result"
          tal:condition="not:view/userPostingInfo/canPost"
          tal:define="statusNum view/userPostingInfo/statusNum;
            status view/userPostingInfo/status;"
          tal:content="structure provider:groupserver.UserCanPost" />
      <!--/div--><!--posting-->
    </tal:block>
    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript"
        src="/++resource++popup_help-20071218.js">&#160;</script>
      <script type="text/javascript">
          jQuery.noConflict();
          jQuery(document).ready( function () {
              GSPopupFormHelp.init('#add-to-topic');
          });
      </script>
      <script type="text/javascript"
        src="/++resource++check_required-20071214.js">&#160;</script>
      <script type="text/javascript"
        tal:define="widgets view/widgets; 
          button string:#form\\.actions\\.add"
        tal:content="provider:groupserver.RequiredWidgetsJavaScript">
        alert("I have not been replaced.");
      </script>
    </tal:block>
  </body>
</html>

