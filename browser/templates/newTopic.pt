<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/@@groupserver_layout/page">
  <head>
  	<title metal:fill-slot="title"
    	tal:define="retval view/update">Start a new topic in
      <span tal:replace="view/groupInfo/name"/>:
      <span tal:replace="view/siteInfo/name"/>
    </title>
    <tal:block metal:fill-slot="metadata">
      <link rel="up" href="#"
        tal:attributes="title view/groupInfo/name;
        href view/groupInfo/url"/>
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title string:${view/groupInfo/name} Homepage;
        href view/groupInfo/url"/>
      <link rel="home" 
        tal:attributes="title string:${view/siteInfo/name} Homepage;
        href view/siteInfo/url"/>
      <link rel="help" title="Help" href="/help"/>
    </tal:block>
  </head>
  <body>
    <div metal:fill-slot="messages" tal:condition="view/status" 
      class="message-error"
      tal:define="e view/errors"
      tal:attributes="class python:e and 'message-error' or 'message-result'">
      <p class="form-status" tal:content="structure view/status"/>
      <dl tal:condition="view/errors">
        <tal:block repeat="widget view/widgets">
          <tal:block tal:condition="widget/error">
            <dt tal:content="widget/label">Widget Name</dt>
            <dd class="error" 
              tal:content="structure widget/error">Error message</dd>
          </tal:block>
        </tal:block>
      </dl>
    </div>
    <tal:block metal:fill-slot="body">
      <h1>Start a New Topic</h1>
      <form tal:condition="view/userPostingInfo/canPost" 
        enctype="multipart/form-data"  method="post" action="."
        id="add-to-topic" tal:attributes="action request/URL">
        <tal:block define="widgets python:[view.widgets['fromAddress'], view.widgets['topic'], view.widgets['message'], view.widgets['uploadedFile']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>
        <div id="fileList">&#160;</div>

        <!--div class="form-widget not-required"
          id="widget-form.uploadedFile">
          <label for="form.uploadedFile"
            title="A file you wish to add.">File</label>
          <input class="hiddenType" id="form.uploadedFile.used"
            name="form.uploadedFile.used" type="hidden" value="" /> 
          <input class="fileType" id="form.uploadedFile" 
            name="form.uploadedFile" size="20" type="file"  />
        </div>--<!--form-widget-->

        <div class="buttons" tal:condition="view/availableActions">
          <tal:block repeat="button view/availableActions">
            <div class="formelementbutton"
              tal:content="structure button/render">Button</div>
          </tal:block>
        </div><!--buttons-->
      </form><!--add-to-topic-->
    </tal:block>
    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript"
        src="/++resource++popup_help-20071218.js">&#160;</script>
      <script type="text/javascript">
          jQuery.noConflict();
          jQuery(document).ready( function () {
              GSPopupFormHelp.init('#add-to-topic');
          });
      </script>
      <script type="text/javascript"
        src="/++resource++check_required-20071214.js">&#160;</script>
      <script type="text/javascript"
        tal:define="widgets view/widgets; 
          button string:#form\\.actions\\.add"
        tal:content="provider:groupserver.RequiredWidgetsJavaScript">
        alert("I have not been replaced.");
      </script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.form.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MetaData.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MultiFile.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.blockUI.js">&#160;</script>
      <script type="text/javascript">
        jQuery.noConflict();
        var renameFileInputs = function(event) {
          var multiFiles = jQuery('.MultiFile-applied');
          var oldId = ''
          var newId = ''
          var i = null;
          var input = null;
          for ( i=0; i < multiFiles.length; i++ ) {
              input = jQuery(multiFiles[i]);
              oldId = input.attr('id');
              newId = oldId + '.' + i;
              input.attr('id', newId).attr('name', newId);
          }
          return true;
        };
        jQuery(document).ready(function () {
          jQuery('#form\\.uploadedFile').MultiFile({
            list: '#fileList'
          });
          jQuery('#add-to-topic').submit(renameFileInputs);
        });
      </script>
    </tal:block>
  </body>
</html>

