<tal:block tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
  post python:options['post'];
  postId python:post['post_id'];
  authorInfo python:options['authorInfo']; 
  authored python:options['authored'];
  showPhoto options/showPhoto;
  postIntro options/postIntro;
  postRemainder options/postRemainder;
  filesMetadata options/filesMetadata">
  <div tal:attributes="class options/cssClass; id string:post-${postId};">
    <p class="email-metadata">
      <a class="topic" tal:condition="options/topicName"
        tal:attributes="href string:/r/topic/${postId};"
        tal:content="options/topicName">A Topic</a>
      <span class="author vcard">
        <strong>From:</strong>
        <a class="fn url" tal:omit-tag="python:authorInfo.anonymous"
          tal:attributes="href python:authorInfo.url;
            title python:u'Profile of %s' % authorInfo.name;"
          tal:content="python:authorInfo.name">Me!</a>
        </span>
      <span class="posted">
        <strong>Date:</strong>
        <span class="date" 
          tal:define="date python:munge_date(options['context'], post['date'])">
          <span 
            tal:replace="date">
            Today, Tomorrow, Timaru
          </span>
        </span>
      </span>
      <a class="email-link"
        tal:attributes="href string:/r/post/${postId};"
        title="A short link to this post">Short link</a>
      </p><!--email-metadata-->
    <div tal:condition="showPhoto"
      tal:define="user python:authorInfo.user"
      tal:replace="structure provider:groupserver.UserImage"/>
    <pre class="email-body"><p tal:replace="structure options/postIntro">
        This is the body of the document.
      </p>
    </pre><!--email-body-->
    <div class="email-remainder"
      tal:define="remId string:emailRemainder${postId}; 
      discloseId string:emailDiscloseButton${postId}">
        <div class="disclosureWidget" tal:condition="options/postRemainder"
          tal:attributes="id remId">
          <p>
            <a class="disclosureButton"
              tal:attributes="href string:javascript:showHideDisclosure('${remId}')"
              href="#">&#160;</a>
          </p>
          <div class="disclosureShowHide" style="display:none;"  
            tal:condition="options/postRemainder">
            <div>
              <pre tal:content="structure options/postRemainder">
                This is the remainder of the email, with such things as the 
                footer.
              </pre>
            </div>
          </div>
      </div>
    </div><!--email-remainder-->	
    <div class="fileNotification" 
      tal:condition="filesMetadata">
      <p tal:condition="python:len(filesMetadata) == 1">The following file was added to this topic:</p>
      <p tal:condition="python:len(filesMetadata) > 1">The following files were added to this topic:</p>
      <div class="fileMetadata"
        tal:repeat="fm filesMetadata">
          <div class="figure"
            tal:condition="python:'image' in fm['mime_type']">
            <a href="#" tal:attributes="href string:/r/img/${fm/file_id}">
              <img src="#"
                tal:attributes="src string:/r/file/${fm/file_id}/resize/72/72/${fm/file_name}"/>
            </a>
          </div><!--figure-->
          <ul>
            <li 
              tal:define="t fm/mime_type;
                iconName python:t.replace('/','-').replace('.','-').strip()">
              Name: 
              <a class="file" href="/favicon.ico" 
                type="application/octet-stream"
                tal:define="img python:(('image' in fm['mime_type']) and 'img') or 'file'"
                tal:attributes="href string:/r/${img}/${fm/file_id}/${fm/file_name};
                  type fm/mime_type;
                  class string:fileName ${iconName};"
                  tal:content="fm/file_name">Filename</a>
            </li>
            <li>Type: 
              <span class="mime"
                tal:content="fm/mime_type">application/octet-stream</span>
            </li>
            <li>
              Size:
              <span class="size"
                tal:content="python:u'%1.2fKB' % (fm['file_size']/1024.0)">-1B</span>
            </li>
          </ul>
      </div><!--fileMetadata-->
    </div><!--fileNotification-->
  </div><!--email-details-->
</tal:block>

