<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/@@groupserver_layout/page">
  <head>

    <!--Todo: add the division name.-->
  	<title metal:fill-slot="title">
      Latest Topics in <span tal:replace="python:view.groupInfo.get_name()">a Group</span>:
      <span tal:replace="python:view.siteInfo.get_name()"/>
    </title>
    
    <meta name="title" content="Template for the Topics Summary"/>
    <meta name="author" content="Michael JasonSmith" />
    <meta name="description" 
      content="This template is used to render the summary of topics within a group" />
    <meta name="date" content="2006-11-02"/>
    
    <tal:block metal:fill-slot="metadata" 
      tal:define="global topicURLPrefix string:topic.html?id=">
      <!-- The documents related to this post -->

      <link rel="previous" title="Previous topics" href=""
        tal:define="global previousURL python:view.get_previous_summary_url()"
        tal:condition="previousURL"
        tal:attributes="href previousURL;">&#160;</link>
      <link rel="next" title="Next topics" href=""
        tal:define="global nextURL python:view.get_next_summary_url()"
        tal:condition="nextURL"
        tal:attributes="href nextURL;">&#160;</link>
      <link rel="first" title="Most recent topics" href="topics.html" 
        tal:condition="previousURL">&#160;</link>
      <link rel="last" title="Oldest topics" href="" 
        tal:condition="nextURL" 
        tal:attributes="href python:view.get_last_summary_url()">&#160;</link>
     
      <link rel="up" title="Group Homepage" href="#"
        tal:attributes="title python:'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()">&#160;</link>
      
      <link rel="bookmark" href="posts.html"
        tal:attributes="title python:'Latest posts in %s' % view.groupInfo.get_name()" />
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title python:'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()">&#160;</link>
      <link rel="home" 
        tal:attributes="title python:'%s Homepage' % view.siteInfo.get_name();
        href python:view.siteInfo.get_url()">&#160;</link>
      <link rel="help" 
        tal:attributes="title python:'%s Help' % view.siteInfo.get_name();
        href python:'%s/help' % view.siteInfo.get_url()">&#160;</link>
    </tal:block>

    <!-- 
      - The standard template used to display a single topic.
      -
      - Like the other message-based templates, the data is martialed
      - out of an XWFVirtualMailingList instance into the page. The
      - template is then passed to the standard GroupServer skin, using
      - the same slots as the GSContent template ("standard.pt").
      -
      -->
    
    <tal:block metal:fill-slot="javascript">
      <!-- Standard GroupServer JavaScript: XForms, Dojo and popup help -->
      <script type="text/javascript" 
        src="/Presentation/Tofu/XForms/js/xforms.js">&#160;</script>
    </tal:block>
    
    <tal:block metal:fill-slot="style">
      <link rel="stylesheet" title="Single-Post Stylesheet" type="text/css" 
        href="/++resource++singlePost.css">&#160;</link>
    </tal:block>
  </head>
  
  <body>
    <!--
      - The error-messages can go in odd places, so define them seperately 
      - from the content. In addition, they can be generated by something 
      - other than the "process_form" method of the view. -->
    <div metal:fill-slot="messages"
      tal:define="result view/process_form;
      isError python:result and result.has_key('error') and result['error'];"
      tal:condition="python:result and result.has_key('message')"
      tal:attributes="class python:(isError and 'message-error') or 'message-result'"
      tal:content="structure result/message"/>

    <!-- 
      - The body of the document. Most of the body-content is created 
      - from the messages, grabbed from the XWFVirtualMailingList
      - instance.
    -->
    <tal:block metal:fill-slot="body">
      <form method="post" action="" 
        enctype="application/x-www-form-urlencoded"
        onkeypress="javascript:return keypressEventHandler(this, event)">
      
        <!-- Site Search -->
        <div id="searcharea">
          <h3>Site Search</h3>
          <input type="text" class="text" name="sitesearch+query"/>
          <input type="submit" name="__submit+sitesearch+search" 
            onclick="submitButtonHandler(this)" value="Go" class="button"/>
        </div>

        <div class="xforms_model">
          <input type="hidden" name="__submit__" value=""/>
          <input type="hidden" name="__models__" value="sitesearch"/>
          <input type="hidden" name="__instance+sitesearch+query" value=""/>
          <input type="hidden" name="__submission_action+sitesearch+search" 
            value="search_all.xml"/>
          <input type="hidden" name="__submission_method+sitesearch+search"
            value="get"/>
        </div>
        <h1>Latest Topics in 
        <span class="group" 
            tal:content="python:view.groupInfo.get_name()">a Group</span></h1>

        <div class="messages-nl" 
          tal:define="len python:view.get_summary_length()">
          <p class="label">Latest Topics Navigation</p>
          <ul>
            <li class="prev">
              <a href="#" tal:condition="previousURL" 
                tal:attributes="href previousURL">Next 
                <span tal:replace="len">-1</span> topics</a>
              <span tal:condition="not:previousURL">Next
                <span tal:replace="len">-1</span> topics
              </span>
            </li>
            <li class="next">
              <a href="#" tal:condition="nextURL"
                tal:attributes="href nextURL">Previous
                <span tal:replace="len">-1</span> topics</a>
              <span tal:condition="not:nextURL">Previous
                <span tal:replace="len">-1</span> topics
              </span>
            </li>
          </ul>
        </div>
        <div class="messages-nl" id="usefulLinks">
          <p class="label">Useful Links</p>
          <ul>
            <li class="posts"><a href="posts.html">Latest posts in
                <span tal:replace="python:view.groupInfo.get_name()" />
              </a>
            </li>
            <li class="start" tal:condition="user/getId | nothing">
              <a href="newTopic.html">Start a new topic</a>
            </li>
          </ul>
        </div>

        <p tal:condition="python:view.start == 0">The following are the
          latest <span tal:content="python:view.get_summary_length()"/> topics in
          <span class="group" 
            tal:content="python:view.groupInfo.get_name()">a Group</span>:
          the topics that have posts in them recently.
          You can view any topic by clicking its name<span tal:condition="nextURL">, or
            view the <span tal:content="python:view.get_summary_length()"/>
            earlier topics by clicking 
            <a href="#" tal:attributes="href nextURL">Previous</a>
          </span>.
        </p>
        
        <table id="topicsSummary">
          <caption>Latest topics in
            <span class="group" 
              tal:content="python:view.groupInfo.get_name()">a Group</span>
          </caption>
          <thead>
            <tr>
              <th class="topic">Topic</th>
              <th class="posts">Posts</th>
              <th class="date">Latest Post</th>
            </tr>
          </thead>
          <tbody tal:define="topics python:view.get_topics();
            stickyTopics python:view.get_sticky_topics();
            timezone python:context.Scripts.get.option('timezone')">
            <tal:block tal:condition="stickyTopics">
              <tr tal:repeat="stickyTopic stickyTopics"
                tal:attributes="id string:sticky-${stickyTopic/id};"
                class="stickyTopic">
                <td class="topic" title="Topic name">
                  <strong>Sticky:</strong>
                  <a href="#" id="foo"
                    tal:attributes="href string:topic.html?id=${stickyTopic/id}"
                    tal:content="stickyTopic/name">Wibble</a>
                </td>
                <td class="posts" title="Number of posts" 
                  tal:content="stickyTopic/length">-1</td>
                <td class="date" title="Date of most recent post"
                  tal:define="date python:stickyTopic['date'].toZone(timezone).strftime('%H')"
                  tal:content="date">Today, Tomorrow, Timaru</td>
              </tr>
            </tal:block>
            
            <tr tal:repeat="topic topics"
              tal:attributes="id topic/id;">
              <td class="topic" title="Topic name">
                <a href="#" id="foo"
                  tal:attributes="href string:topic.html?id=${topic/id}"
                  tal:content="topic/name">Wibble</a>
              </td>
              <td class="posts" title="Number of posts" 
                tal:content="topic/length">-1</td>
              <td class="date" title="Date of most recent post" 
                tal:define="date python:topic['date'].toZone(timezone).strftime('%F %T')">
                <span 
                  tal:replace="date">
                  Today, Tomorrow, Timaru
                </span>
                (<span tal:replace="timezone"/>)
              </td>
            </tr>
          </tbody>
        </table>
      </form><!-- The One True XForm-->
    </tal:block>
  </body>
</html>
