<html metal:use-macro="context/@@groupserver_layout/page">
  <head>
    <!--Todo: add the division name.-->
    <title metal:fill-slot="title">
      Topics in <span tal:replace="python:view.groupInfo.get_name()">a Group</span>:
      <span tal:replace="python:view.siteInfo.get_name()"/>
    </title>
    <meta name="title" content="Template for the Topics Summary"/>
    <meta name="author" content="Michael JasonSmith" />
    <meta name="description" 
      content="This template is used to render the summary of topics within a group" />
    <meta name="date" content="2006-11-02"/>
    <tal:block metal:fill-slot="metadata" 
      tal:define="global topicURLPrefix string:topic/">
      <!-- The documents related to this post -->
      <link rel="previous" title="Later topics" href=""
        tal:define="global laterURL python:view.get_later_url()"
        tal:condition="laterURL"
        tal:attributes="href laterURL;" />
      <link rel="next" title="Earlier topics" href=""
        tal:define="global earlierURL python:view.get_earlier_url()"
        tal:condition="earlierURL"
        tal:attributes="href earlierURL;" />
      <link rel="first" title="Most recent topics" href="topics.html" 
        tal:condition="laterURL" />
      <link rel="last" title="Oldest topics" href="" 
        tal:condition="earlierURL" 
        tal:attributes="href python:view.get_last_url()" />
      <link rel="up" title="Group Homepage" href="#"
        tal:attributes="title python:u'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()" />
      <link rel="bookmark" href="posts.html"
        tal:attributes="title python:u'Posts in %s' % view.groupInfo.get_name()" />
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title python:u'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()" />
      <link rel="home" 
        tal:attributes="title python:u'%s Homepage' % view.siteInfo.get_name();
        href python:view.siteInfo.get_url()" />
      <link rel="help" 
        tal:attributes="title python:u'%s Help' % view.siteInfo.get_name();
        href python:u'%s/help' % view.siteInfo.get_url()" />
    </tal:block>
  </head>
  
  <body>
    <tal:block metal:fill-slot="body"
               tal:define="topics view/get_topics;
                           topic_count python:len(topics)">
      <h1>Topics in 
        <span class="group" 
          tal:content="python:view.groupInfo.get_name()">a Group</span></h1>
      <tal:block define="len python:view.get_summary_length()">
        <ul class="inline-list navlinks" 
          tal:condition="python:topic_count &gt; len">
          <li>
            <a href="#" tal:condition="laterURL" class="prev"
              tal:attributes="href laterURL;
              title string:The ${len} more recent topics;">Later
              <span tal:replace="len">-1</span> topics</a>
            <span tal:condition="not:laterURL" class="prev">Later
              <span tal:replace="len">-1</span> topics
            </span>
          </li>
          <li>
            <a href="#" tal:condition="earlierURL" class="next"
              tal:attributes="href earlierURL;
              title string:The ${len} older topics;">Earlier
              <span tal:replace="len">-1</span> topics</a>
            <span tal:condition="not:earlierURL" class="next">Earlier
              <span tal:replace="len">-1</span> topics
            </span>
          </li>
        </ul>
      </tal:block>
      <div id="usefulLinks">
        <ul class="inline-list">
          <li tal:condition="python:topic_count>0" class="posts"><a href="posts.html">Posts in
              <span tal:replace="python:view.groupInfo.get_name()" />
            </a>
          </li>
          <li class="start" 
            tal:condition="view/userPostingInfo/canPost">
            <a href="newTopic.html">Start a new topic</a>
          </li>
        </ul>
      </div>
      <p class="message-result"
        tal:condition="python:not(view.userPostingInfo.canPost) and (view.userPostingInfo.status != 2)"
        tal:define="statusNum view/userPostingInfo/statusNum;
          status view/userPostingInfo/status;"
        tal:content="structure provider:groupserver.UserCanPost" />
          
      <tal:block tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
        ctx view/context;
        stickyTopics view/get_sticky_topics;
        nonStickyTopics view/get_non_sticky_topics">
        <table id="topicsSummary" 
          tal:condition="python:topic_count>0">
          <caption>Topics in
            <span class="group" 
              tal:content="python:view.groupInfo.get_name()">a Group</span>
          </caption>
          <thead>
            <tr>
              <th class="topic">Topic</th>
              <th class="posts">Posts</th>
              <th class="date">Latest Post</th>
            </tr>
          </thead>
          <tbody tal:define="lenSticky python:len(stickyTopics)">
            <tal:block tal:condition="stickyTopics">
              <tal:block tal:repeat="stickyTopic stickyTopics">
                <tr tal:define="position repeat/stickyTopic/number;"
                  tal:attributes="id string:sticky-${stickyTopic/topic_id};
                  class python:((((position) % 2) == 0) and 'evenStickyTopic') or 'oddStickyTopic';">
                  <td class="topic" title="Topic name">
                    <strong>Sticky:</strong>
                    <a href="#"
                    tal:attributes="href string:topic/${stickyTopic/last_post_id}"
                    tal:content="stickyTopic/subject">Wibble</a>
                  </td>
                  <td class="posts" title="Number of posts"
                    tal:content="stickyTopic/count">-1</td>
                  <td class="date" title="Date of the most recent post"
                    tal:define="date python:munge_date(context, stickyTopic['last_post_date'])">
                    <span 
                    tal:replace="date">
                    Today, Tomorrow, Timaru
                    </span>
                  </td>
                </tr>
              </tal:block>
            </tal:block>
            <tal:block tal:repeat="topic nonStickyTopics">
              <tr id="abc123" 
                tal:define="position repeat/topic/number;
                class python:((((position + lenSticky) % 2) == 0) and 'even') or 'odd';"
                tal:attributes="id topic/topic_id; class class;">
                <td class="topic">
                  <a class="topic" href="#"
                    tal:attributes="href string:/r/topic/${topic/last_post_id}"
                    tal:content="topic/subject"/>
                  <span class="files" tal:condition="topic/files">
                    <tal:block tal:repeat="file topic/files">
                      <a href="#" title="foo"
                        tal:attributes="title file/name;
                          href file/url;
                          class string:fileIcon ${file/icon}">&#160;</a>
                    </tal:block>
                  </span>
                </td>
                <td class="posts">
                  <span class="cardinal" tal:content="topic/num_posts"/>
                </td>
                <td>
                  <a class="name" href="#" 
                    tal:omit-tag="not:topic/last_author/exists"
                    tal:attributes="href topic/last_author/url"
                    tal:content="topic/last_author/name">Me!</a>
                  at
                  <span class="date"
                    tal:content="python:munge_date(ctx, topic['last_post_date'])"/>
                </td>
              </tr>
            </tal:block>
          </tbody>
        </table>
        <p tal:condition="python:not(topic_count>0)">
          There are no topics in this group.
        </p>
        <tal:block define="len python:view.get_summary_length()">
          <ul class="inline-list navlinks" 
            tal:condition="python:topic_count &gt; len">
            <li>
              <a href="#" tal:condition="laterURL" class="prev"
                tal:attributes="href laterURL;
                title string:The ${len} more recent topics;">Later
                <span tal:replace="len">-1</span> topics</a>
              <span tal:condition="not:laterURL" class="prev">Later
                <span tal:replace="len">-1</span> topics
              </span>
            </li>
            <li>
              <a href="#" tal:condition="earlierURL" class="next"
                tal:attributes="href earlierURL;
                title string:The ${len} older topics;">Earlier
                <span tal:replace="len">-1</span> topics</a>
              <span tal:condition="not:earlierURL" class="next">Earlier
                <span tal:replace="len">-1</span> topics
              </span>
            </li>
          </ul>
        </tal:block>
      </tal:block>
    </tal:block>
  </body>
</html>
