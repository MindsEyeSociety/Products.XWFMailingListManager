<li id="topic-index" tal:condition="view/show"
  tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
    entries options/entries;">
  <div class="disclosureWidget">
    <div tal:define="nf view/nFiles; np view/nPosts;">
      <a class="disclosureButton"><strong><span class="val" tal:content="nf">some</span>
        file<tal:block condition="python:nf!=1">s</tal:block></strong>
        in
        <span class="val" tal:content="np">Some</span>
        post<tal:block condition="python:np!=1">s</tal:block></a>
    </div>
    <div class="disclosureShowHide" style="display:none;">
      <table>
        <caption>Posts with files</caption>
        <thead>
          <tr>
            <th class="author">From</th>
            <th class="file">File</th>
            <th class="date">Date</th>
          </tr>
        </thead>
        <tbody>
          <tal:block repeat="entry entries">
            <tr tal:condition="python:len(entry['files']) > 0"
              tal:define="n repeat/entry/number; odd python:n%2"
              tal:attributes="class python:odd and 'odd' or 'even'">
              <td class="author">
                <a tal:condition="not:entry/user" 
                  tal:attributes="href entry/href" 
                  tal:content="structure entry/name">Me!</a>
                <a tal:condition="entry/user" 
                  tal:attributes="href entry/href">
                  <span class="emailname-self"
                    tal:content="structure entry/name">Me!</span></a>
              </td>
              <td class="file" tal:define="files entry/files">
                <tal:block tal:repeat="fm files">
                  <a class="file" href="/favicon.ico" 
                    type="application/octet-stream"
                    tal:define="t fm/mime_type;
                      iconName python:t.replace('/','-').replace('.','-').strip()"
                    tal:attributes="href entry/href;
                      type fm/mime_type;
                      class string:fileName ${iconName};
                      title fm/file_name;" 
                      tal:content="python:fm['file_name'][:50]">&#160;</a>
                </tal:block>
              </td>
              <td tal:define="date python:munge_date(options['context'], entry['date'])"
                class="date">
                <a tal:attributes="href entry/href">
                  <span 
                    tal:replace="date">
                    Today, Tomorrow, Timaru
                  </span>
                </a>
              </td>
            </tr>
          </tal:block>
        </tbody>
      </table>
    </div><!--disclosureShowHide-->
  </div><!--disclosureWidget-->
</li><!--topic-index-->

